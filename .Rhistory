# Cargar librerías
library(haven)   # leer archivos .dta
library(dplyr)   # manipulación de datos
library(ggplot2) # gráficos
library(sf)        # Para manejar datos geoespaciales
# --- Cargar datos ---
# Cambiar al directorio deseado
setwd("~/Desktop/1 economia/7/econometría avanzada/proyecto_econometria_avanzada")
df <- read_dta("/data/controles_results/paraR.dta")
getwd()
ls
df <- read_dta("/data/controles_results/paraR.dta")
df <- read_dta("data/controles_results/paraR.dta")
head(df)
names(df)
panelForIntensity <- panelForIntensity %>%
group_by(zat) %>%
mutate(first_treat = min(ifelse(dummy_oxxo == 1, year, NA), na.rm = TRUE)) %>%
ungroup()
panelForIntensity <- read_dta("data/controles_results/paraR.dta")
# 1. Año de primera entrada de OXXO por ZAT
panelForIntensity <- panelForIntensity %>%
group_by(zat) %>%
mutate(first_treat = min(ifelse(dummy_oxxo == 1, year, NA), na.rm = TRUE)) %>%
ungroup()
panelForIntensity <- panelForIntensity %>%
group_by(zat) %>%
mutate(first_treat = if (any(dummy_oxxo == 1)) min(year[dummy_oxxo == 1]) else NA_real_) %>%
ungroup()
panelForIntensity <- panelForIntensity %>% filter(!is.na(first_treat))
panelForIntensity <- panelForIntensity %>% mutate(rel_time = (year - first_treat) / 4)
panelForIntensity_summary <- panelForIntensity %>%
group_by(first_treat, rel_time) %>%
summarise(
cantidad_oxxo = mean(cantidad_oxxo, na.rm = TRUE),
dummy_jb = mean(dummy_jb, na.rm = TRUE),
dummy_d1 = mean(dummy_d1, na.rm = TRUE),
dummy_ara = mean(dummy_ara, na.rm = TRUE),
cantidad_jb = mean(cantidad_jb, na.rm = TRUE),
cantidad_d1 = mean(cantidad_d1, na.rm = TRUE),
cantidad_ara = mean(cantidad_ara, na.rm = TRUE)
) %>%
ungroup()
# 5. Graficar cada cohorte
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio OXXO",
title = "Evolución relativa de OXXO por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c("2011"="orange", "2015"="blue", "2019"="red", "2023"="green"))
# 5. Graficar cada cohorte
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(df_summary$rel_time):max(df_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c("2011"="orange", "2015"="blue", "2019"="red", "2023"="green"))
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c("2011"="orange", "2015"="blue", "2019"="red", "2023"="green"))
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#FFB3BA",  # rosa pastel
"2015" = "#BAE1FF",  # azul pastel
"2019" = "#BAFFC9",  # verde pastel
"2023" = "#FFF5BA"   # amarillo pastel
))
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#E41A1C",  # rojo fuerte
"2015" = "#377EB8",  # azul intenso
"2019" = "#4DAF4A",  # verde brillante
"2023" = "#FF7F00"   # naranja fuerte
))
# 5. Graficar cada cohorte
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#D7BDE2",  # lila claro
"2015" = "#A569BD",  # morado medio
"2019" = "#7D3C98",  # morado intenso
"2023" = "#4A235A"   # morado muy oscuro
))
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#D7BDE2",  # lila claro
"2015" = "#A569BD",  # morado medio
"2019" = "#7D3C98",  # morado intenso
"2023" = "#4A235A"   # morado muy oscuro
))
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#B39DDB",  # lavanda
"2015" = "#7E57C2",  # morado medio
"2019" = "#5E35B1",  # morado intenso
"2023" = "#4A148C"   # morado muy oscuro
))
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#B39DDB",  # lavanda
"2015" = "#7E57C2",  # morado medio
"2019" = "#5E35B1",  # morado intenso
"2023" = "#4A148C"   # morado muy oscuro
))
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#D7BDE2",  # lila claro
"2015" = "#A569BD",  # morado medio
"2019" = "#F5B7B1",  # rosa suave
"2023" = "#7D3C98"   # morado intenso
))
# 5. Graficar cada cohorte
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#D7BDE2",  # lila claro
"2015" = "#A569BD",  # morado medio
"2019" = "#F5B7B1",  # rosa suave
"2023" = "#7D3C98"   # morado intenso
)) +
scale_shape_manual(values = c(16,17,8,18))
# 5. Graficar cada cohorte
ggplot(panelForIntensity_summary, aes(x = rel_time, y = cantidad_oxxo, color = as.factor(first_treat))) +
geom_line(size = 1) +
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#D7BDE2",  # lila claro
"2015" = "#A569BD",  # morado medio
"2019" = "#F5B7B1",  # rosa suave
"2023" = "#7D3C98"   # morado intenso
)) +
scale_shape_manual(values = c(16,17,8,18))
ggplot(panelForIntensity_summary,
aes(x = rel_time, y = cantidad_oxxo,
color = as.factor(first_treat),
shape = as.factor(first_treat))) +   # <- aquí asignamos la forma
geom_line(size = 1) +
geom_point(size = 3) +                   # <- puntos visibles con forma
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):
max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
title = "Evolución relativa de cantidad de OXXOs por cohorte",
color = "Cohorte",
shape = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#D7BDE2",  # lila claro
"2015" = "#A569BD",  # morado medio
"2019" = "#F5B7B1",  # rosa suave
"2023" = "#7D3C98"   # morado intenso
)) +
scale_shape_manual(values = c(16,17,8,18))  # círculo, triángulo, estrella, diamante
# 5. Graficar cada cohorte
ggplot(panelForIntensity_summary,
aes(x = rel_time, y = cantidad_oxxo,
color = as.factor(first_treat),
shape = as.factor(first_treat))) +   # <- aquí asignamos la forma
geom_line(size = 1) +
geom_point(size = 3) +                   # <- puntos visibles con forma
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):
max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
color = "Cohorte",
shape = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#D7BDE2",  # lila claro
"2015" = "#A569BD",  # morado medio
"2019" = "#F5B7B1",  # rosa suave
"2023" = "#7D3C98"   # morado intenso
)) +
scale_shape_manual(values = c(16,17,8,18))  # círculo, triángulo, estrella, diamante
getwd()
ggsave(paste0("data/controles_results/oxxos_intensidad_tratamiento", y, ".png"), width = 8, height = 6)
ggsave(filename = "data/controles_results/oxxos_intensidad_tratamiento.png",
plot = p,
width = 8, height = 6, dpi = 300)
p <- ggplot(panelForIntensity_summary,
aes(x = rel_time, y = cantidad_oxxo,
color = as.factor(first_treat),
shape = as.factor(first_treat))) +   # <- aquí asignamos la forma
geom_line(size = 1) +
geom_point(size = 3) +                   # <- puntos visibles con forma
geom_vline(xintercept = 0, linetype = "dashed") +
scale_x_continuous(breaks = min(panelForIntensity_summary$rel_time):
max(panelForIntensity_summary$rel_time)) +
labs(
x = "Tiempo relativo (años/4)",
y = "Promedio cantidad de OXXOs en ZAT",
color = "Cohorte",
shape = "Cohorte"
) +
theme_minimal(base_size = 14) +
scale_color_manual(values = c(
"2011" = "#D7BDE2",  # lila claro
"2015" = "#A569BD",  # morado medio
"2019" = "#F5B7B1",  # rosa suave
"2023" = "#7D3C98"   # morado intenso
)) +
scale_shape_manual(values = c(16,17,8,18))  # círculo, triángulo, estrella, diamante
# Guardar el gráfico
ggsave(filename = "data/controles_results/oxxos_intensidad_tratamiento.png",
plot = p,
width = 8, height = 6, dpi = 300)
